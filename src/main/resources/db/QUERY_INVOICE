SELECT ah.document_number,                                              --单据编号
       ah.bp_name,                                                      --发票抬头
       ah.bp_tax_registry_num,
       ah.bp_address_phone_num,
       ah.bp_bank_account,
       (DECODE (ah.contract_id, NULL, NULL, ah.description)) AS description,
       NVL (ah.total_amount_old, ah.total_amount) AS total_amount,
       ah.tax_amount,
       ah.internal_period_num,
       (NVL ( (SELECT he.bill_date
                 FROM acr_ele_invoice_hd he
                WHERE he.invoice_hd_id = ah.invoice_hd_id),
             ah.invoice_date))
          AS invoice_date,
       (NVL (ah.invoice_number,
             (SELECT he.yfphm
                FROM acr_ele_invoice_hd he
               WHERE he.invoice_hd_id = ah.invoice_hd_id)))
          AS invoice_number,
       (SELECT v.code_value_name
          FROM sys_code_values_v v
         WHERE     v.code = 'ACR514_AR_INVOICE_REVERSED_FLAG'
               AND v.code_value = ah.reversed_flag)
          AS reversed_flag_n,
       ah.confirmed_date,                                               --复核日期
       (SELECT u.description
          FROM sys_user u
         WHERE u.user_id = ah.confirmed_by)
          AS confirmed_by_n,                                             --复核人
       (SELECT u.description
          FROM sys_user u
         WHERE u.user_id = ah.created_by)
          AS created_by_n,                                               --开票人
       ah.creation_date,
       (NVL (ah.vat_invoice_code,
             (SELECT he.yfpdm
                FROM acr_ele_invoice_hd he
               WHERE he.invoice_hd_id = ah.invoice_hd_id)))
          vat_invoice_code                                            -- 发票代码
  FROM acr_invoice_hd ah