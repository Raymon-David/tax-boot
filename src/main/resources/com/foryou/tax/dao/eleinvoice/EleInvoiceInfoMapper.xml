<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.foryou.tax.dao.eleinvoice.EleInvoiceInfoMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.foryou.tax.pojo.eleinvoice.EleInvoiceInfo">
        <id column="ELE_INVOICE_ID" property="eleInvoiceId" />
        <result column="INVOICE_ID" property="invoiceId" />
        <result column="DOCUMENT_TYPE" property="documentType" />
        <result column="DOCUMENT_CATEGORY" property="documentCategory" />
        <result column="SERIAL_NUM" property="serialNum" />
        <result column="SALE_TAX" property="saleTax" />
        <result column="CUST_NAME" property="custName" />
        <result column="CUST_TAX_NO" property="custTaxNo" />
        <result column="CUST_ADDR" property="custAddr" />
        <result column="CUST_TELEPHONE" property="custTelephone" />
        <result column="CUST_PHONE" property="custPhone" />
        <result column="CUST_EMAIL" property="custEmail" />
        <result column="CUST_BANK_ACCOUNT" property="custBankAccount" />
        <result column="CUST_TYPE" property="custType" />
        <result column="ELE_INVOICE_MEMO" property="eleInvoiceMemo" />
        <result column="ELE_INVOICE_TYPE" property="eleInvoiceType" />
        <result column="CANCEL_NUM" property="cancelNum" />
        <result column="BILL_TYPE" property="billType" />
        <result column="SPECIAL_RED_FLAG" property="specialRedFlag" />
        <result column="OPERATION_CODE" property="operationCode" />
        <result column="ACCOUNT_PAYEE" property="accountPayee" />
        <result column="ACCOUNT_TIME" property="accountTime" />
        <result column="ISSUER" property="issuer" />
        <result column="ISSUED_TIME" property="issuedTime" />
        <result column="REVIEWER" property="reviewer" />
        <result column="REVIEWED_TIME" property="reviewedTime" />
        <result column="FORMER_INVOICE_CODE" property="formerInvoiceCode" />
        <result column="FORMER_INVOICE_NUM" property="formerInvoiceNum" />
        <result column="ELE_INVOICE_STATUS_CODE" property="eleInvoiceStatusCode" />
        <result column="ELE_INVOICE_STATUS_NAME" property="eleInvoiceStatusName" />
        <result column="PDF_URL" property="pdfUrl" />
        <result column="INVOICE_DATE" property="invoiceDate" />
        <result column="INVOICE_NUMBER" property="invoiceNumber" />
        <result column="INVOICE_CODE" property="invoiceCode" />
        <result column="INVOICE_INTERFACE_STATUS_CODE" property="invoiceInterfaceStatusCode" />
        <result column="INVOICE_INTERFACE_STATUS_NAME" property="invoiceInterfaceStatusName" />
        <result column="INVOICE_INTERFACE_TAX_CODE" property="invoiceInterfaceTaxCode" />
        <result column="INVOICE_INTERFACE_TAX_MESSAGE" property="invoiceInterfaceTaxMessage" />
        <result column="INVOICE_CANCEL_FLAG" property="invoiceCancelFlag" />
        <result column="INVOICE_CANCEL_DESC" property="invoiceCancelDesc" />
        <result column="INVOICE_CANCEL_DATE" property="invoiceCancelDate" />
        <result column="INVOICE_INVALID_FLAG" property="invoiceInvalidFlag" />
        <result column="INVOICE_INVALID_DESC" property="invoiceInvalidDesc" />
        <result column="INVOICE_INVALID_CODE" property="invoiceInvalidCode" />
        <result column="INVOICE_INVALID_NAME" property="invoiceInvalidName" />
        <result column="INVOICE_INTERFACE_INVALID_CODE" property="invoiceInterfaceInvalidCode" />
        <result column="INVOICE_INTERFACE_INVALID_MESSAGE" property="invoiceInterfaceInvalidMessage" />
        <result column="INVOICE_INVALID_DATE" property="invoiceInvalidDate" />
        <result column="INVOICE_REVERSE_FLAG" property="invoiceReverseFlag" />
        <result column="INVOICE_REVERSE_DESC" property="invoiceReverseDesc" />
        <result column="INVOICE_REVERSE_CODE" property="invoiceReverseCode" />
        <result column="INVOICE_REVERSE_NAME" property="invoiceReverseName" />
        <result column="INVOICE_INTERFACE_REVERSE_CODE" property="invoiceInterfaceReverseCode" />
        <result column="INVOICE_INTERFACE_REVERSE_MESSAGE" property="invoiceInterfaceReverseMessage" />
        <result column="INVOICE_RED_NOTICE_NUM" property="invoiceRedNoticeNum" />
        <result column="INVOICE_REVERSE_DATE" property="invoiceReverseDate" />
        <result column="CREATED_BY" property="createdBy" />
        <result column="CREATE_TIME" property="createTime" />
        <result column="UPDATED_BY" property="updatedBy" />
        <result column="UPDATE_TIME" property="updateTime" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        ELE_INVOICE_ID, INVOICE_ID, DOCUMENT_TYPE, DOCUMENT_CATEGORY, SERIAL_NUM, SALE_TAX, CUST_NAME, CUST_TAX_NO, CUST_ADDR, CUST_TELEPHONE, CUST_PHONE, CUST_EMAIL, CUST_BANK_ACCOUNT, CUST_TYPE, ELE_INVOICE_MEMO, ELE_INVOICE_TYPE, CANCEL_NUM, BILL_TYPE, SPECIAL_RED_FLAG, OPERATION_CODE, ACCOUNT_PAYEE, ACCOUNT_TIME, ISSUER, ISSUED_TIME, REVIEWER, REVIEWED_TIME, FORMER_INVOICE_CODE, FORMER_INVOICE_NUM, ELE_INVOICE_STATUS_CODE, ELE_INVOICE_STATUS_NAME, PDF_URL, INVOICE_DATE, INVOICE_NUMBER, INVOICE_CODE, INVOICE_INTERFACE_STATUS_CODE, INVOICE_INTERFACE_STATUS_NAME, INVOICE_INTERFACE_TAX_CODE, INVOICE_INTERFACE_TAX_MESSAGE, INVOICE_CANCEL_FLAG, INVOICE_CANCEL_DESC, INVOICE_CANCEL_DATE, INVOICE_INVALID_FLAG, INVOICE_INVALID_DESC, INVOICE_INVALID_CODE, INVOICE_INVALID_NAME, INVOICE_INTERFACE_INVALID_CODE, INVOICE_INTERFACE_INVALID_MESSAGE, INVOICE_INVALID_DATE, INVOICE_REVERSE_FLAG, INVOICE_REVERSE_DESC, INVOICE_REVERSE_CODE, INVOICE_REVERSE_NAME, INVOICE_INTERFACE_REVERSE_CODE, INVOICE_INTERFACE_REVERSE_MESSAGE, INVOICE_RED_NOTICE_NUM, INVOICE_REVERSE_DATE, CREATED_BY, CREATE_TIME, UPDATED_BY, UPDATE_TIME
    </sql>
    <select id="getEleInvoiceInfo" resultMap="BaseResultMap" parameterType="com.foryou.tax.pojo.eleinvoice.EleInvoiceInfo">
        select
        <include refid="Base_Column_List" />
        from ELE_INVOICE_INFO
        where INVOICE_ID = #{invoiceId}
    </select>
    <update id="updateEleInvoiceTaxError" parameterType="com.foryou.tax.pojo.eleinvoice.EleInvoiceInfo">
        update ELE_INVOICE_INFO
        set INVOICE_INTERFACE_TAX_CODE = #{invoiceInterfaceTaxCode},
            INVOICE_INTERFACE_TAX_MESSAGE = #{invoiceInterfaceTaxMessage}
        where INVOICE_ID = #{invoiceId}
    </update>
    <delete id="deleteData" parameterType="com.foryou.tax.pojo.eleinvoice.EleInvoiceInfo">
        deletet from ELE_INVOICE_INFO
        where ELE_INVOICE_ID = #{eleInvoiceId}
    </delete>
    <select id="searchSerialNum" resultType="java.lang.String" parameterType="com.foryou.tax.pojo.companies.FyCompanies">
        select SERIAL_NUM
        from ELE_INVOICE_INFO
        where substr(SERIAL_NUM, 9, 5) = #{companyId}
        and substr(SERIAL_NUM, 4, 4) = substr(date_format(now(), '%Y%m%d'), 5, 8 )
    </select>
    <select id="getSerialNum1" resultType="java.lang.String" parameterType="com.foryou.tax.pojo.companies.FyCompanies">
        select
        concat(
                'EI',
                '_',
                substr(date_format(now(), '%Y%m%d'), 5, 8 ),
                        '_',
                        (select COMPANY_CODE from FY_COMPANIES where COMPANY_ID = #{companyId} ),
                        '_',
                        trim( ifnull( max(substr(SERIAL_NUM, 15, 6) ), 0 ) + 1 )
                    )
        from ELE_INVOICE_INFO
    </select>
    <select id="getSerialNum2" resultType="java.lang.String" parameterType="com.foryou.tax.pojo.companies.FyCompanies">
        select
        concat(
                'EI',
                '_',
                substr(date_format(now(), '%Y%m%d'), 5, 8 ),
                        '_',
                        (select COMPANY_CODE from FY_COMPANIES where COMPANY_ID = #{companyId} ),
                        '_',
                        rpad(1, 6, 0) + 1
                    )
        from dual
    </select>

</mapper>
